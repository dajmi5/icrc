<?xml version="1.0" encoding="UTF-8" ?>
<!--

    Copyright (C) 2020 Cetmix OÃœ

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU LESSER GENERAL PUBLIC LICENSE as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU LESSER GENERAL PUBLIC LICENSE for more details.

    You should have received a copy of the GNU LESSER GENERAL PUBLIC LICENSE
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<odoo>
    <!--## Tree ##-->
    <record id="prt_mail_message_tree" model="ir.ui.view">
        <field name="name">prt.mail.message.draft.tree</field>
        <field name="model">prt.mail.message.draft</field>
        <field name="arch" type="xml">
            <tree create="false">
                <field name="subject_display" />
                <field name="write_date" />
                <field name="author_id" invisible="1" />
            </tree>
        </field>
    </record>
    <!--## Form ##-->
    <record id="prt_mail_message_draft_form" model="ir.ui.view">
        <field name="name">prt.mail.message.draft.form</field>
        <field name="model">prt.mail.message.draft</field>
        <field name="arch" type="xml">
            <form string="Draft message" create="false">
                <header>
                    <button
                        name="send_it"
                        string="Send"
                        type="object"
                        class="oe_highlight"
                        attrs="{'invisible': [('record_ref','=',False)]}"
                    />
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="subject" />
                        <h1>
                            <field
                                name="subject"
                                class="w-100"
                                required="1"
                                placeholder="Message Subject"
                            />
                        </h1>
                    </div>
                    <group name="base">
                        <group>
                            <field
                                name="record_ref"
                                string="Related record"
                                options="{'no_create': True}"
                            />
                            <field name="author_id" />
                            <field
                                name="partner_ids"
                                widget="many2many_tags_email"
                                context="{'force_email':True}"
                            />
                        </group>
                        <group>
                            <field
                                name="write_date"
                                readonly="1"
                                attrs="{'invisible':[('write_date', '=', False)]}"
                            />
                            <field
                                name="ref_partner_ids"
                                widget="many2many_tags"
                                attrs="{'invisible':[('ref_partner_ids', '=', [])]}"
                            />
                            <field name="subtype_id" widget="selection" />
                        </group>
                    </group>
                    <notebook>
                        <page name="body" string="Content">
                            <field name="body" nolabel="1" />
                            <field name="attachment_ids" widget="many2many_binary" />
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <!--## Action ##-->
    <record id="action_prt_mail_messages_draft" model="ir.actions.act_window">
        <field name="name">Drafts</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">prt.mail.message.draft</field>
        <field name="view_mode">tree,form</field>
    </record>
    <!--## Menu ##-->
    <menuitem
        id="prt_messages_messages"
        name="Drafts"
        action="action_prt_mail_messages_draft"
        parent="prt_mail_messages.prt_messages_root"
        groups="base.group_user,base.group_partner_manager"
        sequence="2"
    />
    <!--## Search ##-->
    <record id="prt_mail_message_draft_search" model="ir.ui.view">
        <field name="name">prt.mail.message.draft.search</field>
        <field name="model">prt.mail.message.draft</field>
        <field name="arch" type="xml">
            <search string="Messages Search">
                <field name="body" />
                <field name="subject" />
                <separator />
                <filter string="Write Date" name="filter_date" date="write_date" />
            </search>
        </field>
    </record>
</odoo>
