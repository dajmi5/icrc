<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_mail_message_tree" model="ir.ui.view">
        <field name="name">icrc_mail_message_tree</field>
        <field name="model">mail.message</field>
        <field name="priority" eval="6"/>
        <field name="arch" type="xml">
            <tree>
                <field name="date"/>
                <field name="subject"/>
                <field name="author_id"/>
                <field name="model" optional="hide"/>
                <field name="res_id" optional="hide"/>
                <field name="record_name" optional="hide"/>
                <field name="message_type" optional="show"/>
                <field name="subtype_id" optional="show"/>
                <field name="preview" optional="hide"/>
            </tree>
        </field>
    </record>
    <record id="view_icrc_mail_message_form" model="ir.ui.view">
        <field name="name">icrc_mail_message_form</field>
        <field name="model">mail.message</field>
        <field name="arch" type="xml">
            <form string="Message" duplicate="0">
                <header>

                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_open_document" string="Open Document" type="object"
                                class="oe_link" icon="fa-file-text-o"
                                attrs="{'invisible': ['|', ('model', '=', False), ('res_id', '=', 0)]}"/>
                    </div>
                    <group>
                        <group>
                            <field name="email_from"/>
                            <field name="author_id"/>
                            <field name="subject"/>
                            <field name="date"/>

                            <field name="message_type"/>
                            <field name="subtype_id"/>
                            <field name="is_internal"/>
                        </group>
                        <group>
                            <field name="model"/>
                            <field name="res_id"/>
                            <field name="record_name"/>
                            <field name="parent_id"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Body" name="body">
                            <field name="body" options="{'style-inline': true}"/>
                        </page>
                        <page name="attachments" string="Attachments" attrs="{'invisible':[('attachment_ids', '=', [])]}">
                            <sheet>
                                <field name="attachment_ids" widget="many2many_binary"/>
                            </sheet>
                        </page>
                        <page string="Gateway" name="gateway" groups="base.group_no_one">
                            <group>
                                <group>
                                    <field name="reply_to"/>
                                    <field name="reply_to_force_new"/>
                                </group>
                                <group>
                                    <field name="message_id"/>
                                    <field name="mail_server_id"/>
                                </group>
                            </group>
                        </page>
                        <page string="Recipients" name="recipients">
                            <group>
                                <group>
                                    <field name="partner_ids" widget="many2many_tags"/>
                                </group>
                                <group>
                                    <field name="notified_partner_ids" widget="many2many_tags"/>
                                    <field name="starred_partner_ids" widget="many2many_tags"/>
                                </group>
                            </group>
                            <group>
                                <field name="notification_ids">
                                    <tree>
                                        <field name="res_partner_id"/>
                                        <field name="is_read"/>
                                        <field name="notification_type"/>
                                        <field name="notification_status"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                        <page string="Tracking" name="page_tracking">
                            <field name="tracking_value_ids"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <record id="view_message_search" model="ir.ui.view" >
            <field name="name">mail_message_search</field>
            <field name="model">mail.message</field>
            <field name="arch" type="xml">
                <search string="Messages Search">
                    <field name="body" string="Content" filter_domain="['|', '|', ('record_name', 'ilike', self) ,('subject', 'ilike', self), ('body', 'ilike', self)]" />
                    <field name="subject"/>
                    <field name="record_name"/>
                    <field name="message_type"/>
                    <field name="author_id"/>
                    <field name="partner_ids"/>
                    <field name="model"/>
                    <field name="res_id"/>
                    <field name="parent_id"/>
                    <filter string="Has Mentions"
                            name="filter_has_mentions"
                            domain="[('partner_ids.user_ids', 'in', [uid])]"/>
                    <separator/>
                    <filter string="Need Action"
                            name="message_needaction" help="Unread messages"
                            domain="[('needaction', '=', True)]"/>
                    <separator/>
                    <filter string="Emails"
                            name="message_type_email" help="Email messages"
                            domain="[('message_type', '=', 'email')]"/>
                    <filter string="Comments"
                            name="message_type_comment" help="Message type Comments"
                            domain="[('message_type', '=', 'comment')]"/>
                    <filter string="Noticifations"
                            name="message_type_notification" help="Notifications"
                            domain="[('message_type', '=', 'notification')]"/>
                    <group>
                        <filter string="Message Type" name="group_type" context="{'group_by': 'message_type'}"/>
                        <filter string="Message subtype" name="group_subtype" context="{'group_by': 'subtype_id'}"/>
                        <separator/>
                        <filter string="Model" name="group_model" context="{'group_by': 'model'}"/>
                        <filter string="Record name" name="group_rec" context="{'group_by': 'record_name'}"/>
                        <filter string="Parent message" name="group_parent" context="{'group_by': 'parent_id'}"/>
                    </group>
                </search>
            </field>
        </record>

    <!-- actions -->
    <record
        id="action_helpdesk_ticket_mail_from_dashboard"
        model="ir.actions.act_window"
    >
        <field name="name">Ticket Messages</field>
        <field name="res_model">mail.message</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
            {'default_helpdesk_team_id': active_id}
        </field>
        <field name="domain">[('model', '=', 'helpdesk.ticket')]</field>
    </record>
    <record
        id="action_helpdesk_team_mail_from_dashboard"
        model="ir.actions.act_window"
    >
        <field name="name">Team Messages</field>
        <field name="res_model">mail.message</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
            {'default_helpdesk_team_id': active_id}
        </field>
        <field name="domain">['&amp;', ('model', '=', 'helpdesk.ticket.team'), ('res_id', '=', active_id)]</field>
    </record>
    <record
        id="action_helpdesk_channel_mail_from_dashboard"
        model="ir.actions.act_window"
    >
        <field name="name">Channel Messages</field>
        <field name="res_model">mail.message</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
            {'default_helpdesk_team_id': active_id}
        </field>
        <field name="domain">[('model', '=', 'mail.channel')]</field>
    </record>
    <record
        id="action_helpdesk_all_mail_from_dashboard"
        model="ir.actions.act_window"
    >
        <field name="name">All Messages</field>
        <field name="res_model">mail.message</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
            {'default_helpdesk_team_id': active_id}
        </field>
        <field name="domain">[('model', 'in', ['helpdesk.ticket', 'helpdesk.ticket.team', 'mail.channel'])]</field>
    </record>
</odoo>